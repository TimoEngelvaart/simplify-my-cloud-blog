---
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { blogPageContent } from "../../config";
import { render } from "astro:content";

const posts = await getCollection("posts");
posts.sort((a, b) => {
  const dateA = new Date(a.data.pubDate).getTime();
  const dateB = new Date(b.data.pubDate).getTime();
  return dateB - dateA;
});
for (const post of posts) {
  const { remarkPluginFrontmatter } = await render(post);
  post.data.readingTime = remarkPluginFrontmatter.minutesRead;
}
---

<Layout seo={blogPageContent.seo}>
  <section class="max-w-4xl mx-auto px-6 pt-20 pb-24">
    <div class="mb-12">
      <h1 class="font-bold text-4xl mb-2 text-gray-900 dark:text-gray-100">Blog</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">{blogPageContent.subtitle}</p>
    </div>

    <div class="space-y-6">
      {
        posts.map((post) => (
          <a
            href={`/blog/${post.id}`}
            class="group block border border-gray-200 dark:border-gray-800 rounded-lg overflow-hidden hover:border-gray-300 dark:hover:border-gray-700 transition-colors"
          >
            <div class="flex flex-col sm:flex-row">
              <div class="relative overflow-hidden aspect-video sm:aspect-square sm:w-64 bg-secondary flex-shrink-0">
                <Image
                  src={post.data.image.url}
                  alt={post.data.image.alt}
                  width={400}
                  height={400}
                  class="w-full h-full object-cover"
                />
              </div>
              <div class="p-6 flex-1 flex flex-col justify-center">
                <div class="flex items-center gap-2 text-xs text-gray-500 dark:text-gray-500 mb-3">
                  <time datetime={post.data.pubDate.toISOString()}>
                    {post.data.pubDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                  </time>
                  <span>Â·</span>
                  <span>{post.data.readingTime}</span>
                </div>
                <h3 class="font-semibold text-xl mb-2 text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">{post.data.title}</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">{post.data.description}</p>
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </section>
</Layout>
